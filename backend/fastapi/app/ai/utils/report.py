from ai.utils.ai_request import generate_response

async def create_prompt(
    statement: str,
    similar_text: str,
    ) -> str:
    """
    ë‘ ì‚¬ìš©ìì˜ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜.

    Args:
        text (str): ì‚¬ìš©ìì˜ ì…ë ¥ í…ìŠ¤íŠ¸.

    Returns:
        str: ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´.
    """
    return f"""
    í† ë¡  í‰ê°€ ê¸°ì¤€ì— ë”°ë¼ ë‹¤ìŒ ë°œì–¸ì„ í‰ê°€í•´ì£¼ì„¸ìš”.

    ë°œì–¸ ë‚´ìš©: {statement}

    ìœ ì‚¬í•œ ì£¼ì¥:
    {similar_text}
    """

async def create_instruction(user_id: int) -> str:
    """
    ë‘ ì‚¬ìš©ìì˜ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ AI ëª¨ë¸ì˜ ì—­í•  ë° í–‰ë™ ì§€ì¹¨ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜.

    Args:
        text (str): ì‚¬ìš©ìì˜ ì…ë ¥ í…ìŠ¤íŠ¸.
        

    Returns:
        str: ìƒì„±ëœ ai í–‰ë™ ì§€ì¹¨ ë¬¸ìì—´.
    """
    return f"""
    ë„ˆëŠ” í† ë¡  ëŒ€íšŒë¥¼ ì‹¬ì‚¬í•˜ëŠ” ì‹¬ì‚¬ìœ„ì›ì´ì•¼.  
    ì‹¬ì‚¬ìœ„ì›ì˜ ì…ì¥ì—ì„œ ì°¸ê°€ìì˜ ë°œì–¸ì„ í‰ê°€í•˜ê³  ì ìˆ˜ë¥¼ ë¶€ì—¬í•  ê±°ì•¼. 
    {user_id} ì˜ ê°’ì„ ê°€ì§„ ì°¸ê°€ìì˜ ë°œì–¸ì„ ë¶„ì„í•˜ê³  ì „ì²´ ë§¥ë½ì„ ê³ ë ¤í•˜ì—¬ ì°¸ê°€ìì˜ ì—­ëŸ‰ì„ í‰ê°€í•´ì¤˜. 
    
    ğŸ“Œ í‰ê°€ ê¸°ì¤€ (100ì  ë§Œì , ì„¸ë¶€ ë°°ì  í¬í•¨):  
    1ï¸âƒ£ ë…¼ë¦¬ì  êµ¬ì¡° í‰ê°€ (reasoning, 40ì )  
    - ë…¼ê±° ê°œìˆ˜ ë° ë°°ì¹˜ (ì£¼ìš” ë…¼ì ì´ ì ì ˆí•œ íë¦„ìœ¼ë¡œ ë°°ì¹˜ë˜ì—ˆëŠ”ê°€?)  
    - ë…¼ê±° ê°„ ë…¼ë¦¬ì  ì—°ê³„ì„± (ê·¼ê±°ì™€ ì£¼ì¥ì´ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆëŠ”ê°€?)  
    - ìƒëŒ€ ë…¼ì ì— ëŒ€í•œ ëŒ€ì‘ (ìƒëŒ€ ì£¼ì¥ ë°˜ë°• ë° ë¹„êµ ë¶„ì„ì´ íš¨ê³¼ì ì¸ê°€?)  
    - ë…¼ë¦¬ì  ì¼ê´€ì„± (ìì‹  ë° íŒ€ ë‚´ ì£¼ì¥ ê°„ ëª¨ìˆœì´ ì—†ëŠ”ê°€?)  

    2ï¸âƒ£ í‘œí˜„ ë° ì „ë‹¬ë ¥ í‰ê°€ (expression, 20ì )  
    - í•µì‹¬ í‚¤ì›Œë“œ ë° ë¹ˆë„ ë¶„ì„ (ë°˜ë³µì ì´ê³  ì„¤ë“ë ¥ ìˆëŠ” í‘œí˜„ì´ ìˆëŠ”ê°€?)  
    - ì„¤ë“ë ¥ ìˆëŠ” í‘œí˜„ ê¸°ë²• í™œìš© (ë¹„ìœ , ë°˜ë³µ, ê°ì •ì  í˜¸ì†Œ ë“± ì ì ˆíˆ ì‚¬ìš©í–ˆëŠ”ê°€?)  

    3ï¸âƒ£ ì „ëµ ë° ì—­í•  ìˆ˜í–‰ (strategy, 20ì )  
    - ì—­í•  ìˆ˜í–‰ (í•´ë‹¹ ìœ„ì¹˜ì— ë§ëŠ” ì—­í• ì„ ìˆ˜í–‰í–ˆëŠ”ê°€?)  
    - ë°œì–¸ ì‹œê°„ í™œìš© (ì ì ˆí•œ ì†ë„ë¡œ ì‹œê°„ ë‚´ í•µì‹¬ ë…¼ê±°ë¥¼ ì œì‹œí–ˆëŠ”ê°€?)  

    4ï¸âƒ£ ìƒí˜¸ì‘ìš© ë° íƒœë„ (interaction, 20ì )  
    - POI í™œìš© ë° ëŒ€ì‘ (ìƒëŒ€ì˜ ì§ˆë¬¸ì„ ì˜ í™œìš©í•˜ê³ , íš¨ê³¼ì ìœ¼ë¡œ ë‹µë³€í–ˆëŠ”ê°€?)  
    - ë°œì–¸ íƒœë„ ë° ì˜ˆì˜ (ìƒëŒ€ë°©ì„ ì¡´ì¤‘í•˜ë©° í† ë¡ ì„ ì§„í–‰í–ˆëŠ”ê°€?)  

    ğŸ“Œ ì ìˆ˜ ë¶€ì—¬ ë°©ì‹ (100ì  ë§Œì  ê¸°ì¤€):  
    - ì°¸ê°€ì 4ëª…ì—ê²Œ ê° í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜(ë…¼ë¦¬, í‘œí˜„, ì „ëµ, ìƒí˜¸ì‘ìš©)ì„ ë¶€ì—¬í•´ì•¼ í•œë‹¤.  
    - ì ìˆ˜ì™€ í•¨ê»˜ ê° í‰ê°€ ê¸°ì¤€ë³„ 150ì ë‚´ì™¸ì˜ ìƒì„¸í•œ ì„¤ëª…ì„ í¬í•¨í•´ì•¼ í•œë‹¤.  
    - ì„¤ëª…ì—ëŠ” ì˜í•œ ì ì€ ì¸ìš©í•˜ê³ , ë¶€ì¡±í•œ ì ì€ ê°œì„  ì˜ˆì‹œë¥¼ ë“¤ì–´ ì„¤ëª…í•´ì•¼ í•œë‹¤.  
    - ì„¤ëª…ì€ êµ¬ì²´ì ì´ê³  ë…¼ë¦¬ì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•œë‹¤.  

    ğŸ“Œ ì¶œë ¥ í˜•ì‹  
    AIëŠ” ì•„ë˜ êµ¬ì¡°ë¥¼ ì •í™•íˆ ë”°ë¼ì•¼ í•œë‹¤.  

    ì¶œë ¥ í˜•ì‹:
    [ì´ì , ëª¨ë“  ì ìˆ˜ì˜ í•©]/[ë°œì–¸ì ì „ì²´ í‰ê°€]/[reasoning ì ìˆ˜]/[reasoning ì„¤ëª…]/[expression ì ìˆ˜]/[expresssion ì„¤ëª…]/[strategy ì ìˆ˜]/[strategy ì„¤ëª…]/[interaction ì ìˆ˜]/[interaction ì„¤ëª…]

    ì•„ë˜ëŠ” ì‹¤ì œ ë‹µë³€ ì˜ˆì‹œì•¼.
    ë‹µë³€ ì˜ˆì‹œ:
    85/Aì˜ ë°œì–¸ì€ ì–´ë–¤ ì ì—ì„œ ì ì ˆí–ˆìŠµë‹ˆë‹¤./32/AëŠ” ë‚™íƒœê°€ ì—¬ì„±ì˜ ìê¸°ê²°ì •ê¶Œì´ë¼ëŠ” ì£¼ì¥ì„ ì¼ê´€ë˜ê²Œ ìœ ì§€í•˜ë©°, ì´ë¡œ ì¸í•´ ì—¬ì„±ì˜ ì‚¶ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ê°•ì¡°í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ íƒœì•„ì˜ ìƒëª…ê¶Œì— ëŒ€í•œ ë°˜ë°•ì€ ìƒëŒ€ì ìœ¼ë¡œ ì•½í–ˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, 'ê°•ì œ ì¶œì‚°ì€ ì—¬ì„±ì˜ ì‚¶ì„ ìœ„í˜‘í•œë‹¤'ëŠ” ì£¼ì¥ì— ëŒ€í•´ êµ¬ì²´ì ì¸ ì‚¬ë¡€ë‚˜ ë°ì´í„°ë¥¼ í†µí•´ ë” ê°•ë ¥í•˜ê²Œ ë’·ë°›ì¹¨í–ˆìœ¼ë©´ ì¢‹ì•˜ì„ ê²ƒì…ë‹ˆë‹¤./18/AëŠ” 'ìê¸°ê²°ì •ê¶Œ'ê³¼ 'ê±´ê°•ê¶Œ'ì´ë¼ëŠ” í•µì‹¬ í‚¤ì›Œë“œë¥¼ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©í•˜ë©° ì£¼ì¥í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê°ì •ì  í˜¸ì†Œë‚˜ ë¹„ìœ  ë“±ì˜ í‘œí˜„ ê¸°ë²•ì„ ë” í™œìš©í•˜ë©´ ë°œì–¸ì˜ ì„¤ë“ë ¥ì„ ë†’ì¼ ìˆ˜ ìˆì—ˆì„ ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ê°•ì œ ì¶œì‚°ì˜ ë¶€ì •ì  ê²°ê³¼ë¥¼ êµ¬ì²´ì ì¸ ì‚¬ë¡€ë¡œ ì œì‹œí•˜ë©´ ë” íš¨ê³¼ì ì¼ ê²ƒì…ë‹ˆë‹¤./18/AëŠ” ì²« ë²ˆì§¸ ë°œì–¸ìë¡œì„œ ìì‹ ì˜ ì…ì¥ì„ ëª…í™•íˆ í–ˆìœ¼ë©°, ìƒëŒ€ë°©ì˜ ì£¼ì¥ì— ëŒ€í•œ ë°˜ë°•ì„ í†µí•´ ë…¼ì˜ë¥¼ ì´ëŒì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë°˜ëŒ€ ì¸¡ì˜ ì£¼ì¥ì— ëŒ€í•œ ê¹Šì´ ìˆëŠ” ë°˜ë°•ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íƒœì•„ì˜ ìƒëª…ê¶Œì— ëŒ€í•œ ë°˜ë°•ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ì œì‹œí–ˆìœ¼ë©´ ì¢‹ì•˜ì„ ê²ƒì…ë‹ˆë‹¤./17/AëŠ” ìƒëŒ€ë°©ì˜ ì£¼ì¥ì— ëŒ€í•´ ë¹„êµì  ì˜ ëŒ€ì‘í–ˆìœ¼ë‚˜, ìƒëŒ€ë°©ì˜ ë…¼ì ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ì§ˆë¬¸ì´ë‚˜ ë…¼ì˜ê°€ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤. ìƒëŒ€ì˜ ì£¼ì¥ì„ ë”ìš± ê¹Šì´ ë¶„ì„í•˜ê³ , ì§ˆë¬¸ì„ í†µí•´ ë…¼ì˜ë¥¼ í™•ì¥í–ˆìœ¼ë©´ ë” ë‚˜ì€ ìƒí˜¸ì‘ìš©ì„ ë§Œë“¤ ìˆ˜ ìˆì—ˆì„ ê²ƒì…ë‹ˆë‹¤.
    """

async def generate_chat_response(
    user_id: int,
    statement:str,
    similar_text: str, 
    ) -> str:
    """-
    ë‘ ì‚¬ìš©ìì˜ í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•˜ê³ , Google Generative AIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜.

    Args:
        text (str): ì‚¬ìš©ìì˜ ì…ë ¥ í…ìŠ¤íŠ¸.

    Returns:
        str: AIê°€ ìƒì„±í•œ ì‘ë‹µ í…ìŠ¤íŠ¸.
    """
    # í”„ë¡¬í”„íŠ¸ ìƒì„±
    prompt = await create_prompt(statement, similar_text)
    system_instruction = await create_instruction(user_id)
    # ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ë¡œ AI í˜¸ì¶œ
    return await generate_response(prompt=prompt, system_instruction=system_instruction)

    