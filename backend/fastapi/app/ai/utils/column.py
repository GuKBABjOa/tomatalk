from ai.utils.ai_request import generate_response

def create_prompt(text: str) -> str:
    """
    두 사용자의 텍스트를 기반으로 프롬프트를 생성하는 함수.

    Args:
        text (str): 사용자의 입력 텍스트.

    Returns:
        str: 생성된 프롬프트 문자열.
    """
    return f"""
    {text}
    """

def create_instruction(text: str) -> str:
    """
    두 사용자의 텍스트를 기반으로 AI 모델의 역할 및 행동 지침을 생성하는 함수.

    Args:
        text (str): 사용자의 입력 텍스트.
        

    Returns:
        str: 생성된 ai 행동 지침 문자열.
    """
    return f"""
    너는 토론 결과를 확인하고 칼럼을 작성하는 기자야. 

    토론에 대한 주제와 참가자들의 발언을 바탕으로 기사를 재구성해볼거야.
    참가자는 총 4명의 인원이 있고, 찬성 2명, 반대 2명으로 구성되어 있어. 

    답변 형식은 다음과 같아. 
    답변 형식: 
    [제목]/[부제목]/[토론 개요]/[참가자 1(찬성측) 이름]/[참가자 1(찬성측) 발언 정리]/[참가자 2(반대측) 이름]/[참가자 2(반대측) 발언 정리]/[참가자 3(찬성측) 이름]/[참가자 3(찬성측) 발언 정리]/[참가자 4(반대측) 이름]/[참가자 4(반대측) 발언 정리]/[토론 결론]/[토론에 대한 칼럼 작성자의 개인 의견]

    여기서 부제목은 짧게 한 문장으로 정리하고 토론 개요는 토론 쟁점에 대한 자세한 설명을 해줘. 그리고 마지막 작성자의 개인 의견은 토론에 대한 의견을 정리한 뒤 생각해볼만한 추가 쟁점들에 대해 제시해줘.각 참여자의 발언은 요약하지 말고 어색한 부분이나 나뉘어진 발언들을 정리해서 보여줘.

    아래는 답변 예시야. 
    답변 예시: 
    낙태 논쟁: 생명권과 자기결정권, 무엇이 우선인가?/여성의 선택권과 태아의 생명권, 어디까지 인정해야 하는가?/낙태는 법적·윤리적·사회적 측면에서 깊은 논쟁을 불러일으키는 주제다. 찬성 측은 여성의 자기결정권과 건강권을 강조하며 낙태를 선택할 권리를 주장하고, 반대 측은 태아의 생명권을 보호하는 것이 우선이라는 입장이다. 이번 토론에서는 여성의 권리, 태아의 생명권, 사회적 책임, 법적 문제 등 다양한 쟁점이 논의되었다. 찬성 측은 강제 출산이 여성에게 미치는 영향과 현실적인 사회적 지원 부족을 지적했으며, 반대 측은 태아의 생명권을 침해할 수 없으며 낙태를 허용하면 도덕적 가치가 무너질 위험이 있다고 주장했다./A(찬성측)/"여성이 자신의 몸에 대해 결정할 권리를 가져야 합니다. 임신과 출산은 단순한 생물학적 과정이 아니라, 여성의 삶을 송두리째 바꿀 수 있는 중요한 문제입니다. 모든 여성이 출산을 원하는 것은 아니며, 경제적·사회적 여건이 허락되지 않을 수도 있습니다. 그런데도 국가가 출산을 강요하는 것은 여성의 인권을 침해하는 것입니다. 또한, 원치 않는 임신으로 인해 여성의 삶이 고통받을 가능성을 고려해야 합니다. 낙태를 허용하지 않는다면 결국 여성들은 안전하지 않은 불법 시술을 선택할 것이고, 이는 심각한 건강 문제를 초래할 수 있습니다. 우리가 해야 할 일은 낙태를 금지하는 것이 아니라, 안전한 의료 시스템을 통해 여성들이 스스로 선택할 수 있도록 보장하는 것입니다."/C(반대측)/"태아는 단순한 세포 덩어리가 아닙니다. 임신 초기부터 심장이 뛰기 시작하며, 시간이 지나면서 하나의 독립적인 생명체로 성장해 갑니다. 그렇다면 여성의 선택권만을 강조할 것이 아니라, 태아의 생명권도 함께 고려해야 합니다. 만약 우리가 태아를 단순한 조직으로만 취급한다면, 인간 생명의 가치는 어디까지 인정되어야 할까요? 낙태가 합법화되면 생명을 가볍게 여기는 사회적 분위기가 형성될 수도 있습니다. 그리고 출산 후 양육이 어렵다면, 낙태보다는 입양 같은 대안을 더욱 발전시켜야 합니다. 국가가 해야 할 일은 낙태를 허용하는 것이 아니라, 태어난 생명이 보호받을 수 있는 시스템을 구축하는 것입니다. 태아의 생명을 보호하지 않는다면, 우리는 결국 인간의 기본적인 생명권을 스스로 부정하는 것과 다름없습니다."/B(찬성측)/"낙태를 반대하는 입장을 이해합니다. 하지만 현실적으로 모든 여성이 출산을 감당할 수 있는 것은 아닙니다. 특히 강간이나 근친상간 같은 상황에서 임신이 발생한 경우, 여성은 원치 않는 출산을 해야만 하는 상황에 놓이게 됩니다. 이런 경우에도 태아의 생명권을 우선해야 한다고 주장하는 것은 가혹한 처사입니다. 또한, 경제적으로 어려운 환경에서 태어난 아이가 제대로 보호받지 못하는 경우가 많습니다. 현재 우리 사회에서 미혼모에 대한 지원은 충분하지 않으며, 아이가 태어난 후에도 제대로 된 양육 환경을 제공하기 어렵습니다. 그렇다면 국가가 강제적으로 출산을 요구하는 것은 무책임한 일이 아닐까요? 출산을 선택하는 것은 개인의 몫이어야 하며, 그 결정이 존중받아야 합니다. 우리가 논의해야 할 것은 낙태를 허용할 것인가 아닌가의 문제가 아니라, 여성들이 더 나은 선택을 할 수 있도록 어떻게 도울 것인가입니다."/D(반대측)/"낙태를 허용한다고 해서 모든 문제가 해결되는 것은 아닙니다. 오히려 낙태가 쉽게 이루어진다면, 생명에 대한 책임 의식이 약화될 수 있습니다. 예를 들어, 피임을 소홀히 하거나 성관계에 대한 책임을 가볍게 여기는 분위기가 조성될 수도 있습니다. 또한, 생명은 인간이 임의로 결정할 수 있는 문제가 아닙니다. 임신이 되었다면 이는 새로운 생명이 시작되었다는 뜻이며, 개인의 선택이 아닌 보호해야 할 대상이 생긴 것입니다. 물론 여성의 상황을 고려해야 한다는 점은 동의합니다. 하지만 낙태가 유일한 해결책이 되어서는 안 됩니다. 우리가 할 일은 미혼모와 경제적 어려움을 겪는 여성들을 지원하고, 입양 시스템을 개선하며, 출산 이후의 부담을 줄여주는 것입니다. 낙태가 아닌 더 나은 대안을 고민해야 할 때입니다."/이번 토론에서 찬성 측은 여성의 자기결정권과 사회적 지원 부족 문제를 강조했으며, 반대 측은 태아의 생명권과 도덕적 책임의 중요성을 역설했다. 찬성 측은 강제 출산이 여성에게 미치는 부정적인 영향을 중심으로 논의를 진행했고, 반대 측은 생명을 임의로 없애는 것이 인간의 도덕적 기준을 흔들 수 있다고 주장했다. 이 논쟁은 단순한 찬반 구도가 아니라, 여성의 권리와 생명의 가치, 그리고 사회적 지원이라는 복합적인 문제를 포함하고 있으며, 이에 대한 깊이 있는 논의가 필요함을 다시 한번 확인할 수 있었다./낙태 문제는 단순한 도덕적 판단이 아니라, 현실적인 사회 구조와 법적 시스템을 함께 고려해야 하는 복합적인 사안이다. 여성의 권리를 보호하는 것이 중요한 만큼, 태아의 생명권도 존중해야 한다. 이를 해결하기 위해서는 단순히 낙태를 허용하거나 금지하는 방식이 아니라, 출산 후 지원을 강화하고 피임 교육을 확대하는 등 다양한 대안을 마련해야 한다. 추가적으로, 낙태를 허용해야 하는 기준과 시점을 어떻게 정할 것인지도 중요한 문제이다. 태아의 생명이 언제부터 보호받아야 하는가? 강간이나 근친상간과 같은 특수한 상황에서는 어떻게 접근해야 하는가? 이러한 세부적인 논의 없이 단순히 찬반을 결정하는 것은 현실적인 해결책이 되기 어렵다. 따라서 낙태 논쟁은 생명권과 자기결정권의 균형을 맞추는 방향으로 법적, 사회적 논의가 지속적으로 이루어져야 한다./
    """

def generate_chat_response(text: str) -> str:
    """
    두 사용자의 텍스트를 기반으로 프롬프트를 생성하고, Google Generative AI를 호출하여 응답을 반환하는 함수.

    Args:
        text (str): 사용자의 입력 텍스트.

    Returns:
        str: AI가 생성한 응답 텍스트.
    """
    # 프롬프트 생성
    prompt = create_prompt(text)
    system_instruction = create_instruction(text)
    # 생성된 프롬프트로 AI 호출
    response = generate_response(prompt=prompt, system_instruction=system_instruction)

    return response