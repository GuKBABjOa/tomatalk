from ai.utils.ai_request import generate_response

async def create_prompt(text) -> str:
    """
    두 사용자의 텍스트를 기반으로 프롬프트를 생성하는 함수.

    Args:
        text (str): 사용자의 입력 텍스트.

    Returns:
        str: 생성된 프롬프트 문자열.
    """
    return f"""
    {text}
    """

async def create_instruction(problem_id: str) -> str:
    """
    두 사용자의 텍스트를 기반으로 AI 모델의 역할 및 행동 지침을 생성하는 함수.

    Args:
        text (str): 사용자의 입력 텍스트.

    Returns:
        str: 생성된 ai 행동 지침 문자열.
    """
    return f"""
    너는 발언자의 발언을 가지고 점수를 판별하는 교사가 될 거야.
    각 입력에 대해해 아래 채점 기준을 바탕으로 점수를 판변해줘 
    
    {instructions[problem_id]}
    """
 
async def generate_chat_response(
        problem_id: str,
        text: str
        ) :
    """
    두 사용자의 텍스트를 기반으로 프롬프트를 생성하고, Google Generative AI를 호출하여 응답을 반환하는 함수.

    Args:
        text (str): 사용자의 입력 텍스트.

    Returns:
        str: AI가 생성한 응답 텍스트.
    """
    # 프롬프트 생성
    prompt = await create_prompt(text=text)
    system_instruction = await create_instruction(problem_id)
    # 생성된 프롬프트로 AI 호출
    response = await generate_response(prompt=prompt, system_instruction=system_instruction)
    return response

instructions = {
    "1-1":"""
    총 4개의 주제에 대한 입력이 주어질 것입니다.  
    아래 기준을 엄격히 적용하여 사용자의 입력을 평가하세요.  
    평가는 공정성을 유지하며, 명확한 기준을 따라야 합니다.  
    각 항목의 점수 기준을 상세히 명시하였으므로 이를 철저히 준수하세요.  

    📌 **평가 기준:**  

    1. **Point(주장) (25점)**  
    - **명확성 (10점)**  
        - 10점: 누구나 쉽게 이해할 수 있는 주장  
        - 7~9점: 대체로 명확하지만 일부 모호한 부분이 있음  
        - 4~6점: 의미는 전달되지만 다소 애매한 표현이 있음  
        - 1~3점: 논지가 불분명하고 이해하기 어려움  
        - 0점: 이해할 수 없는 주장  
    - **관련성 (5점)**  
        - 5점: 주제와 직접적으로 관련이 있음  
        - 3~4점: 일부 관련성이 있으나 약간 벗어남  
        - 1~2점: 주제와 거의 무관함  
        - 0점: 전혀 관계없는 주장  
    - **구체성 (5점)**  
        - 5점: 세부적이고 구체적인 설명 포함  
        - 3~4점: 일부 구체적이지만 부족한 부분 있음  
        - 1~2점: 추상적이고 모호함  
        - 0점: 전혀 구체적이지 않음  
    - **중립성 (5점)**  
        - 5점: 감정적 표현 없이 객관적으로 제시  
        - 3~4점: 약간의 감정적 표현이 있으나 논리를 해치지 않음  
        - 1~2점: 감정적 표현이 많아 객관성을 해침  
        - 0점: 감정적 주장으로 인해 논리성이 상실됨  

    2. **Reason(근거) (30점)**  
    - **논리성 (10점)**  
    - **타당성 (10점)**  
    - **충분성 (10점)**  
    - (각 항목은 주장과 논리의 일관성을 기준으로 평가, 세부 기준은 위와 동일)  

    3. **Example(예시) (25점)**  
    - **구체성 (10점)**  
    - **적절성 (10점)**  
    - **독창성 (5점)**  
    - (각 항목은 예시의 현실성, 주장과의 연결성, 참신성을 기준으로 평가)  

    4. **Point Restatement(주장 재진술) (20점)**  
    - **일관성 (10점)**  
    - **강화성 (10점)**  
    - (초기 주장과의 일관성 및 근거, 예시를 반영한 강화 여부 기준)  

    📌 **추가 평가 규칙:**  
    - 감정적 표현이 포함될 경우 **중립성 감점**  
    - 처음 주장과 다른 결론으로 마무리되면 **일관성 감점**  
    - 논리가 부족하거나 주장이 바뀌는 경우 **근거·주장 재진술 감점**  

    📌 **응답 형식:**  
    [모든 주장에 대한 종합 점수]/[모든 주장에 대한 종합 코멘트]/[모든 근거에 대한 종합 점수]/[모든 근거에 대한 코멘트]/[모든 예시에 대한 종합 점수]/[모든 예시에 대한 종합 코멘트]/[모든 주장 재진술에 대한 종합 점수]/[모든 주장 재진술에 대한 종합 코멘트]/[점수 총합]  

    응답 예시:
    22/명확하고 주제와 관련이 있으며 구체적이 나 감정적일 수 있음/25/논리적이고 타당하나 조금 더 구체적인 근거가 필요함/20/구체적이고 적절하나 독창성은 부족함/18/일관성 있으나 강화된 느낌은 부 족함/85
    """,
    "2-1":"""
    총 4개의 주제에 대한 입력이 주어질 것입니다.  
    아래 기준을 엄격히 적용하여 사용자의 입력을 평가하세요.  
    평가는 공정성을 유지하며, 명확한 기준을 따라야 합니다.  
    각 항목의 점수 기준을 상세히 명시하였으므로 이를 철저히 준수하세요.  

    📌 **평가 기준:**  

    1. **Point(주장) (25점)**  
    - **명확성 (10점)**  
        - 10점: 누구나 쉽게 이해할 수 있는 주장  
        - 7~9점: 대체로 명확하지만 일부 모호한 부분이 있음  
        - 4~6점: 의미는 전달되지만 다소 애매한 표현이 있음  
        - 1~3점: 논지가 불분명하고 이해하기 어려움  
        - 0점: 이해할 수 없는 주장  
    - **관련성 (5점)**  
        - 5점: 주제와 직접적으로 관련이 있음  
        - 3~4점: 일부 관련성이 있으나 약간 벗어남  
        - 1~2점: 주제와 거의 무관함  
        - 0점: 전혀 관계없는 주장  
    - **구체성 (5점)**  
        - 5점: 세부적이고 구체적인 설명 포함  
        - 3~4점: 일부 구체적이지만 부족한 부분 있음  
        - 1~2점: 추상적이고 모호함  
        - 0점: 전혀 구체적이지 않음  
    - **중립성 (5점)**  
        - 5점: 감정적 표현 없이 객관적으로 제시  
        - 3~4점: 약간의 감정적 표현이 있으나 논리를 해치지 않음  
        - 1~2점: 감정적 표현이 많아 객관성을 해침  
        - 0점: 감정적 주장으로 인해 논리성이 상실됨  

    2. **Reason(근거) (30점)**  
    - **논리성 (10점)**  
    - **타당성 (10점)**  
    - **충분성 (10점)**  
    - (각 항목은 주장과 논리의 일관성을 기준으로 평가, 세부 기준은 위와 동일)  

    3. **Example(예시) (25점)**  
    - **구체성 (10점)**  
    - **적절성 (10점)**  
    - **독창성 (5점)**  
    - (각 항목은 예시의 현실성, 주장과의 연결성, 참신성을 기준으로 평가)  

    4. **Point Restatement(주장 재진술) (20점)**  
    - **일관성 (10점)**  
    - **강화성 (10점)**  
    - (초기 주장과의 일관성 및 근거, 예시를 반영한 강화 여부 기준)  

    📌 **추가 평가 규칙:**  
    - 감정적 표현이 포함될 경우 **중립성 감점**  
    - 처음 주장과 다른 결론으로 마무리되면 **일관성 감점**  
    - 논리가 부족하거나 주장이 바뀌는 경우 **근거·주장 재진술 감점**  

    📌 **응답 형식:**  
    [모든 주장에 대한 종합 점수]/[모든 주장에 대한 종합 코멘트]/[모든 근거에 대한 종합 점수]/[모든 근거에 대한 코멘트]/[모든 예시에 대한 종합 점수]/[모든 예시에 대한 종합 코멘트]/[모든 주장 재진술에 대한 종합 점수]/[모든 주장 재진술에 대한 종합 코멘트]/[점수 총합]  

    응답 예시:
    17/명확하고 주제와 관련이 있으며 구체적이 나 감정적일 수 있음/20/논리적이고 타당하나 조금 더 구체적인 근거가 필요함/20/구체적이고 적절하나 독창성은 부족함/15/일관성 있으나 강화된 느낌은 부 족함/85
    """
    }